# Vylepšený sensor pre vonkajšiu teplotu
# Tento sensor správne spracováva unavailable/unknown stavy

- sensor:
    - name: "Vonkajsia teplota"
      unique_id: real_outdoor_temp
      state: >
        {% set temps = namespace(values=[]) %}
        
        {# Skontroluj prvý senzor (východ) #}
        {% set temp1_state = states('sensor.indoor_outdoor_teplota') %}
        {% if temp1_state not in ['unavailable', 'unknown', 'none', ''] %}
          {% set temp1 = temp1_state | float(none) %}
          {% if temp1 is not none %}
            {% set temps.values = temps.values + [temp1] %}
          {% endif %}
        {% endif %}
        
        {# Skontroluj druhý senzor (západ) #}
        {% set temp2_state = states('sensor.temp_vonku_temperature') %}
        {% if temp2_state not in ['unavailable', 'unknown', 'none', ''] %}
          {% set temp2 = temp2_state | float(none) %}
          {% if temp2 is not none %}
            {% set temps.values = temps.values + [temp2] %}
          {% endif %}
        {% endif %}
        
        {# Vráť minimum z dostupných hodnôt, alebo unknown #}
        {% if temps.values | length > 0 %}
          {{ temps.values | min | round(1) }}
        {% else %}
          {{ 'unknown' }}
        {% endif %}
      unit_of_measurement: "°C"
      device_class: "temperature"
      state_class: "measurement"
      availability: >
        {# Sensor je dostupný, ak aspoň jeden zo vstupných senzorov má platnú hodnotu #}
        {# indoor_outdoor_teplota = západ, temp_vonku_temperature = východ #}
        {% set temp_zapad = states('sensor.indoor_outdoor_teplota') %}
        {% set temp_vychod = states('sensor.temp_vonku_temperature') %}
        {{ temp_zapad not in ['unavailable', 'unknown', 'none', ''] or 
           temp_vychod not in ['unavailable', 'unknown', 'none', ''] }}

